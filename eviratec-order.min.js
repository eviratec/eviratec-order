/**
 * eviratec-order
 *
 * Build date: 21-04-2018
 *
 * Copyright (c) 2018 Callan Peter Milne
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
 * REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
 * AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
 * INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
 * LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
 * OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
 * PERFORMANCE OF THIS SOFTWARE.
 */

!function(e,t){var n,o,a,i,l,r,s="Color",c="Choose color",u="Change",d="Save",p="text-color",f="color";t.eviratec_ajax_url=eviratec_ajax_object.ajax_url,r=function(){"use strict";function t(t,n){var o=this,a=t,i=e(document.createElement("div")),l=e(document.createElement("div")),r=e(document.createElement("input")),s=e(document.createElement("div")),c=e(document.createElement("button")),u=e(document.createElement("button"));i.addClass("color-picker"),l.addClass("color-picker-content"),r.attr("type","color"),r.val(t),l.appendTo(i),r.appendTo(l),u.addClass("cancel"),u.html('<span class="material-icons">cancel</span>'),u.appendTo(l),s.addClass("horizontal-spacer"),s.appendTo(l),c.html(d),c.appendTo(l),c.click(function(e){e.preventDefault(),a=r.val(),n(r.val()),o.toggle()}),u.click(function(e){e.preventDefault(),r.val(a),o.toggle()}),Object.defineProperties(this,{$el:{value:i}})}return t.prototype.toggle=function(){this.$el.toggle()},t}(),o=function(){"use strict";function t(t){var n=e(document.createElement("div")),o=e(document.createElement("div"));n.addClass("color-indicator"),o.addClass("color"),o.appendTo(n),o.html("<span></span><span>"+c+"</span><span></span>"),Object.defineProperties(this,{$el:{value:n}}),this.setBackgroundColor=function(e){o.attr("style","background-color: "+e)}}return t.prototype.setCurrentColor=function(e){this.setBackgroundColor(e)},t}(),a=function(){"use strict";function t(t){var n=e(document.createElement("div")),o=e(document.createElement("div"));n.addClass("color-indicator"),o.addClass("text-color"),o.appendTo(n),o.html('<span></span><span class="text-preview large">AaBb</span><span class="text-preview small">AaBbCcDdEeFfGgHh</span>'),Object.defineProperties(this,{$el:{value:n}}),this.setTextColor=function(e){o.attr("style","color: "+e)}}return t.prototype.setCurrentColor=function(e){this.setTextColor(e)},t}(),l=function(){"use strict";return function(t){var n=e(document.createElement("footer")),o=e(document.createElement("button"));o.appendTo(n),o.html(u),o.click(function(e){e.preventDefault()}),Object.defineProperties(this,{$el:{value:n},$buttonEl:{value:o}})}}(),i=function(){"use strict";return function(t){var n=t.title||s,o=e(document.createElement("header")),a=e(document.createElement("h4"));a.appendTo(o),a.html(n),Object.defineProperties(this,{$el:{value:o}})}}(),n=function(){"use strict";function t(t){var n,c,u,d,h=this,m=t.cardTitle||s,v=function(e,t){if(!e)return t;return e}(t.initialValue,t.defaultValue),g=e(document.createElement("div")),E=(u=t.id,(d=e(document.createElement("input"))).attr("type","hidden"),d.attr("name",u),d),y=new i({title:m}),C=new l;switch(g.addClass("card-element color-card"),t.cardType){case p:n=new a;break;case f:n=new o}y.$el.appendTo(g),n.$el.appendTo(g),C.$el.appendTo(g),E.appendTo(g),Object.defineProperties(this,{$el:{value:g},$inputEl:{value:E}}),(c=new r(v,function(e){h.setValue(e),n.setCurrentColor(e),t.onColorChange&&t.onColorChange()})).$el.appendTo(g),c.$el.hide(),C.$buttonEl.click(function(){c.toggle()}),this.setValue(v),n.setCurrentColor(v)}return t.prototype.setValue=function(e){this.$inputEl.val(e)},t}(),e.taColorCard=function(e){(e=e||{}).cardType=f;var t=e.$containerEl,o=new n(e);if(!t)throw new Error("Unable to initialise ColorCard: No $containerEl option");o.$el.appendTo(t)},e.taTextColorCard=function(e){(e=e||{}).cardType=p;var t=e.$containerEl,o=new n(e);if(!t)throw new Error("Unable to initialise ColorCard: No $containerEl option");o.$el.appendTo(t)}}(jQuery,window),function(e,t){var n,o,a,i,l="Add custom navigation link",r="delete",s="Text",c="Target URL";a=function(){"use strict";return function(e,t){this.title=e||"",this.target=t||""}}(),o=function(){"use strict";return function(t,n,o){var i=new a(n,o),l=this,u=e(document.createElement("li")),d=e(document.createElement("input")),p=e(document.createElement("input")),f=e(document.createElement("button"));d.attr("placeholder",s),p.attr("placeholder",c),d.val(i.title),p.val(i.target),d.appendTo(u),p.appendTo(u),d.change(function(){i.title=d.val(),t.persist()}),p.change(function(){i.target=p.val(),t.persist()}),f.html('<span class="material-icons">'+r+"</span>"),f.appendTo(u),f.click(function(e){e.preventDefault(),t.removeLink(l)}),Object.defineProperties(this,{$el:{value:u},model:{value:i}})}}(),n=function(){"use strict";function t(t){var n=[],o=t.initialValue&&JSON.parse(t.initialValue)||[],a=e(document.createElement("ol")),i=e(document.createElement("input"));i.attr("name",t.id),i.attr("type","hidden"),i.appendTo(a),Object.defineProperties(this,{$el:{value:a},links:{value:n}}),this.persist=function(){for(var e=n.slice(0),t=0;t<e.length;t++)e[t]={title:e[t].model.title,target:e[t].model.target};i.val(JSON.stringify(e))};for(var l=0;l<o.length;l++)this.addLink(o[l].title,o[l].target)}return t.prototype.removeLink=function(e){var t=this.links.indexOf(e);this.links.splice(t,1),e.$el.remove(),this.persist()},t.prototype.addLink=function(e,t){var n=new o(this,e,t);this.links.push(n),n.$el.appendTo(this.$el),this.persist()},t}(),i=function(){"use strict";return function(t){var o=e(document.createElement("div")),a=e(document.createElement("button")),i=new n(t);i.$el.appendTo(o),a.addClass("btn form-btn"),a.html(l),a.appendTo(o),a.click(function(e){e.preventDefault(),i.addLink()}),Object.defineProperties(this,{$el:{value:o}})}}(),e.taSidenavLinkManagerComponent=function(e){var t=(e=e||{}).$el,n=new i(e);if(!t)throw new Error("Unable to initialise SidenavLinkManager: No $el option");n.$el.appendTo(t)}}(jQuery,window),function(e,t,n){"use strict";var o,a,i,l,r="file",s="hidden";o=function(){function n(n,o,a,i){var l,c,u,d;this.uploadComponent=o,u=a,(d=t.createElement("input")).setAttribute("type",u),c=e(l=d),Object.defineProperties(this,{type:{value:a},fileType:{value:i},el:{value:l},$el:{value:c}}),c.attr("name",n+(s===a?"-url":"-file")),r===a&&c.attr("accept",function(e){if("image"===e.fileType)return"image/*";if("icon"===e.fileType)return"image/*";if("font"===e.fileType)return".woff,.woff2,.ttf,.otf"}(this))}return n.prototype.setValue=function(e){r!==this.type&&this.$el.val(e)},n.prototype.getValue=function(){return this.$el.val()},n.prototype.showInEl=function(e){this.$el.appendTo(e)},n.prototype.onChange=function(e){this.$el.on("change",e)},n}(),i=function(){function t(t){var n=e(document.createElement("div"));n.addClass("upload-details"),n.html("No "+t+" selected."),Object.defineProperties(this,{$el:{value:n},d:{value:{remotePath:""}}})}return t.prototype.setRemotePath=function(e){return this.d.remotePath=e,this.$el.html(e),this},t}(),a=function(){var t={};function n(n,a,l,c,u,d,p){var f=new o(n,this,r,l),h=new o(n,this,s),m=e(document.createElement("button")),v=new i(l);function g(e){return!1===d?"":null===e?"No file uploaded yet":""===e?"":e.split("/").slice(-1)[0]}c=c||null,d=void 0===d||d,p=p||function(){},m.addClass("btn form-btn file-select-btn"),Object.defineProperties(this,{id:{value:n},fileInput:{value:f},uploadData:{value:h}}),a.addClass("file-upload-component"),m.html('<span style="flex:auto;"></span><span class="material-icons">file_upload</span><span>'+t[l]+'</span><span style="flex:auto;"></span>'),!0===d&&m.appendTo(a),f.showInEl(a),h.showInEl(a),v.setRemotePath(g(c)),e.ltS3Upload({s3Bucket:"https://s3-ap-southeast-2.amazonaws.com/upload-eviratec-com/",containerEl:a,photoUrlEl:h.$el,uploadInputEl:f.$el,initialValue:c,storageId:u,onBeforeUpload:function(e){console.log(e),g("")},onUploadComplete:function(e){v.setRemotePath(g(e.upload.photo.remoteUrl)),p(e.upload.photo.remoteUrl),console.log(e)}}),v.$el.appendTo(a)}return t.font="Upload font",t.icon="Upload icon",t.image="Upload image",n.prototype.processUpload=function(){},n.prototype.getValue=function(){return this.uploadData.getValue()},n}(),l=function(e){return function(){}}(),function(){e.taAppPreview=function(e,t){var n,o;n=(t=t||{}).$form,o=t.$el,uploadComponent=new function(e){e=e||{},Object.defineProperties(this,{data:{value:e}})}({$el:o,appIcon:n.find("input[name=app-icon-url]").val(),appName:n.find("input[name=app-name]").val(),navLinks:n.find("input[name=app-sidenav-links-data]").val(),navHeaderImage:n.find("input[name=app-sidenav-header-image-url]").val(),font:n.find("input[name=app-custom-font-url]").val(),textColor:n.find("input[name=text-color]").val(),primaryColor:n.find("input[name=primary-color]").val(),secondaryColor:n.find("input[name=secondary-color]").val(),splashScreenBackground:n.find("input[name=app-intro-background-image-url]").val(),introCards:n.find("input[name=app-intro-cards-data]").val()})}}(),function(){new l;e.taAssetUploadComponent=function(e){var t,n,o,i,l;t=(e=e||{}).$el,n=e.category||"image",o=e.initialValue||"",i=e.storageId||"__unknown_id__",l=void 0===e.showUi||e.showUi,new a(e.id,t,n,o,i,l,e.onComplete)},e(document).ready(function(){e("#OrderButton_Back"),e("#OrderButton_Skip"),e("#OrderButton_Continue");var t=e("#OrderForm"),n=t.find("input[name=prev-step]").val(),o=t.find("input[name=next-step]").val();function a(){t.attr("action",o),t.submit()}e("ol.feature-list li.feature").click(function(t){e(t.target).parents("li.feature").find("input[type=checkbox]")[0].click()}),e("#OrderButton_Back").click(function(){t.attr("action",n),t.submit()}),e("#OrderButton_Continue").click(function(){a()}),e("#OrderButton_Skip").click(function(){a()}),e("#menu .step-navigation li a").each(function(n,o){var a=e(o).attr("href");e(o).click(function(e){e.preventDefault(),e.stopPropagation(),t.attr("action",a),t.submit()})})})}()}(jQuery,document,window),function(e,t){"use strict";var n,o,a,i=["account_balance","account_balance_wallet","card_giftcard","card_membership","card_travel","credit_card","face","favorite","favorite_border","home","language","loyalty","motorcycle","pets","redeem","room","search","shopping_basket","shopping_cart","star","stars","store","today","toll","touch_app","visibility","watch_later","work","textsms","flight","local_pizza","cake","local_bar","local_cafe","local_convenience_store","local_dining","local_drink","local_florist","local_gas_station","local_hotel","local_mall","local_movies","local_offer","local_play","local_taxi","map","rate_review","restaurant","public","whatshot","share","sentiment_very_satisfied","mood","person","group"];a=function(){function t(t,n){var o=this,a=e(document.createElement("div")),l=e(document.createElement("ul"));a.addClass("icon-drawer"),l.appendTo(a),i.forEach(function(n){var a=e(document.createElement("li"));a.html('<span class="material-icons">'+n+"</span>"),a.click(function(){t.setIcon(n),o.close()}),a.appendTo(l)}),Object.defineProperties(this,{$el:{value:a}}),this.close()}return t.prototype.toggle=function(){this.$el.toggle()},t.prototype.close=function(){this.$el.hide()},t.prototype.open=function(){this.$el.show()},t}(),n=function(){function t(){var t=e(document.createElement("div"));return t.attr("style","flex:auto;"),t}return function(n){var o,i,l,r=this,s=e(document.createElement("div")),c=(l="icon",o=[n.id,l].join("-"),(i=e(document.createElement("input"))).attr("type","hidden"),i.attr("name",o),i),u=new a(this,n),d=e(document.createElement("div")),p=e(document.createElement("span"));function f(e){if(!0===e)return d.removeClass("has-icon"),void d.addClass("needs-icon");d.removeClass("needs-icon"),d.addClass("has-icon")}u.$el.appendTo(s),d.addClass("screen-icon"),p.addClass("material-icons"),s.addClass("onboarding-screen-icon"),p.appendTo(d),t().appendTo(s),d.appendTo(s),t().appendTo(s),c.appendTo(s),Object.defineProperties(this,{$el:{value:s},$valueEl:{value:c}}),d.click(function(){u.open()}),this.setIconDisplay=function(e){if(!e)return f(!0),void p.html("add");f(!1),p.html(e)},this.setIcon=function(e){r.$valueEl.val(e),r.setIconDisplay(e)},this.setIcon((h=n,m="icon",v=h.initialValues[m],g=h.defaultValues[m],v||g));var h,m,v,g}}(),o=function(){function t(t){var i=this,l=e(document.createElement("div")),r=e(document.createElement("h3")),s=new n(t),c=o(d("headline")),u=o(d("text"));function d(e){return[t.id,e].join("-")}l.addClass("card-element onboarding-card"),c.addClass("onboarding-screen-headline"),u.addClass("onboarding-screen-text"),c.attr("placeholder","Headline"),u.attr("placeholder","Text"),r.html(t.cardTitle),r.appendTo(l),s.$el.appendTo(l),c.appendTo(l),u.appendTo(l),c.change(function(){c.val()?i.needsHeadlineValue(!1):i.needsHeadlineValue(!0)}),u.change(function(){u.val()?i.needsTextValue(!1):i.needsTextValue(!0)}),Object.defineProperties(this,{$el:{value:l},cardIconElement:{value:s},$headlineValueEl:{value:c},$textValueEl:{value:u}}),this.setHeadline(a(t,"headline")),this.setText(a(t,"text"))}function o(t){var n=e(document.createElement("input"));return n.attr("name",t),n}function a(e,t){return function(e,t){if(!e)return t;return e}(e.initialValues[t],e.defaultValues[t])}return t.prototype.setIcon=function(e){this.cardIconElement.setIcon(e)},t.prototype.setHeadline=function(e){e?(this.needsHeadlineValue(!1),this.$headlineValueEl.val(e)):this.clearHeadline()},t.prototype.setText=function(e){e?(this.needsTextValue(!1),this.$textValueEl.val(e)):this.clearText()},t.prototype.clearHeadline=function(){this.needsHeadlineValue(!0),this.$headlineValueEl.val("")},t.prototype.clearText=function(){this.needsTextValue(!0),this.$textValueEl.val("")},t.prototype.needsHeadlineValue=function(e){if(!0===e)return this.$headlineValueEl.removeClass("has-value"),void this.$headlineValueEl.addClass("needs-value");this.$headlineValueEl.removeClass("needs-value"),this.$headlineValueEl.addClass("has-value")},t.prototype.needsTextValue=function(e){if(!0===e)return this.$textValueEl.removeClass("has-value"),void this.$textValueEl.addClass("needs-value");this.$textValueEl.removeClass("needs-value"),this.$textValueEl.addClass("has-value")},t}(),e.taOnboardingCard=function(e){var t=(e=e||{}).$containerEl,n=new o(e);if(!t)throw new Error("Unable to initialise OnboardingCard: No $containerEl option");n.$el.appendTo(t)}}(jQuery,window),function(e,t){e.ltS3Upload=function(n){function o(e,t){var o={};this.file=t,this.queue=e,this.photo=new function(e){var t;this.remoteUrl=(t=e.name,n.s3Bucket+window.location.hostname+"/"+n.storageId+"/"+encodeURI(t))}(t),this.uploadUrl=this.photo.remoteUrl,this.gridItem=null,this.log=function(e){o[e]=Date.now()},this.getTransferTimeMs=function(){return o.done-o.start},this.getBytesTransferred=function(){return this.file.size},this.getTransferKbps=function(){if(!o.start||!o.done)return 0;var e=this.getBytesTransferred(),t=this.getTransferTimeMs();return Math.ceil(e/t)}}n=n||{contailerEl:null,photoUrlEl:null,uploadInputEl:null,initialValue:null,storageId:"__UNKNOWN_ID__",onBeforeUpload:function(){},onUploadComplete:function(){}};var a=t._GRID=new function(t){console.log(t),this.add=function(n){var o=new function(t,n){var o=e('<li class="photo-wrap"><div class="file-name"></div></li>');o.find("div.file-name").html(n.file.name),this.setImgSrc=function(e){o.attr("style","background-image:url("+e+")")},this.el=function(){return o}}(this,n);return t.append(o.el()),o}}(e("ol#photoManager")),i=t._QUEUE=new function(t){var n={waiting:[],inprogress:null,finished:[]},a={onItemAdded:[],onEmpty:[],onBeforeUpload:[],onUploadComplete:[]},i=0,l=0,r=0,s=0,c=0,u=0;function d(e,t){a[e]&&a[e].length&&a[e].forEach(function(e){e(t)})}function p(){var t,o;null===n.inprogress?(t=n.waiting.pop())?(r++,n.inprogress=t,(o=t).log("start"),e.ajax({url:o.photo.remoteUrl,method:"put",data:o.file,processData:!1,contentType:"multipart/form-data; charset=UTF-8",beforeSend:function(e){var t=o,a=t.photo;t.gridItem,d("onBeforeUpload",{xhr:e,upload:o}),e.always(function(){console.log("always"),console.log(arguments)}).progress(function(){console.log("progress event"),console.log(arguments)}).done(function(){var e;t.gridItem.setImgSrc(a.remoteUrl),t.log("done"),console.log("***",t.getTransferKbps()),(e=t)===n.inprogress&&(n.finished.push(e),u++,e.file.size&&(l+=e.file.size),d("onUploadComplete",{upload:e}),n.inprogress=null,c--),p()})}})):d("onEmpty"):console.log("already uploading",n.inprogress)}this.stats=function(){return{currentUploadN:r,count:{items:{added:s,queued:c,finished:u}},total:{bytes:i,bytesTransferred:l}}},this.add=function(e){e=new o(this,e),n.waiting.push(e),e.gridItem=t.add(e),e.file.size&&(i+=e.file.size),c++,s++,d("onItemAdded",{upload:e}),p()},this.on=function(e,t){a[e].push(t)},this.uploadNext=p}(a),l=t._PROGRESS=new function(t){var n,o=0,a=0,i=0,l=0,r=e('<div class="progress-view-wrapper">  <div class="progress-indicator"></div>  <div class="progress-view">    <span>Uploading</span>    <span class="current-upload-n">1</span>    <span>of</span>    <span class="total-upload-n">1</span>  </div></div>');function s(){l+=550*i,u(Math.ceil((o+l)/a*100))}function c(){return!!n}function u(e){r.find("div.progress-indicator span.progress").attr("style","width: "+e+"%"),r.find("div.progress-percent").html(e+"%")}this.setSpeedTick=function(e){l=0,i=e,0!==e?c()||(n=setInterval(s,500)):c()&&clearInterval(n)},this.show=function(){r.show()},this.hide=function(){r.hide()},this.stat=function(e){var t,n,i,l;t=e.currentUploadN,r.find("span.current-upload-n").html(t),n=e.count.items.added,r.find("span.total-upload-n").html(n),i=e.total.bytesTransferred,l=e.total.bytes,o=i,a=l,u(Math.ceil(o/a*100))},this.el=function(){return r}}(i);function r(e){n.photoUrlEl.val(e)}console.log(i),i.on("onItemAdded",function(e){console.log("*onBeforeUpload*",e),l.stat(i.stats())}),i.on("onBeforeUpload",function(e){console.log("*onBeforeUpload*",e),n.onBeforeUpload(e),l.stat(i.stats()),l.show()}),i.on("onUploadComplete",function(e){console.log("*onUploadComplete*",e),r(e.upload.photo.remoteUrl),n.onUploadComplete(e),l.stat(i.stats()),l.setSpeedTick(e.upload.getTransferKbps()),l.hide()}),i.on("onEmpty",function(e){console.log("*onEmpty*",e),l.stat(i.stats()),l.setSpeedTick(0),l.hide()}),n.containerEl.append(l.el()),l.hide(),null!==n.initialValue&&r(n.initialValue),n.uploadInputEl.on("change",function(e){var t,n=e.target.files;t=n,console.log("Queuing uploads"),console.log(t),Array.prototype.forEach.call(t,function(e){i.add(e)})})}}(jQuery,window);